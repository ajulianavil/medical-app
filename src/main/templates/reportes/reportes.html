{% extends 'main/layout.html' %}
{% load static %}
{% load my_filters %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/search_record.css' %}" />
<script src="{% static 'js/validations.js' %}"></script>
{% endblock %}
{% block content %}

  <div>
    <div class="container-fluid row" style="padding-top: 30px">
      <h2 class="mb-4" style="font-weight: bold; color: #0796D8">Buscar reporte</h2>
    </div>
    <div class="input-group input-group-sm"
        style="padding-top: 0; position: relative; padding-right:100px; padding-left:20px ">
        <form class="search-formm" method="POST">
          {% csrf_token %}
          <div class="row">
            <div class="col-6">
              <label> Cédula de paciente </label> 
            </div>
            {% comment %} <div class="col-4">
              <label> Número de reporte </label> 
            </div> {% endcomment %}
          </div>
          <div class="row">
            <div class="col-6">
              <input type="text" class="form-control" placeholder="Cédula de paciente" id="id_input" name="id_input" oninput="validateNumberInput(this)" maxlength="12" />
            </div>
            <div class="col-2" style="display: flex;
            align-items: center;
            justify-content: space-between; border: none">
              <button type="submit" class="round-button">
                <i class="fas fa-search fa-lg"></i>
              </button>
            </div>
            </div>
        </form>
    </div>
    <br>
    {% if messages %}
      {% for message in messages %}
          <div class="alert alert-warning">
              {{ message }}
          </div> 
      {% endfor %}
    {% endif %}
    <br>
    <div class="container">
    <table id="myTable">
      <thead>
        <tr>
          <th style="text-align: center;">Fecha consulta</th>
          <th style="text-align: center;">Cédula paciente</th>
          <th style="text-align: center;">Médico encargado</th>
          <th style="text-align: center;">Motivo de consulta</th>
          <th style="text-align: center;">Ver reporte</th>
        </tr>
      </thead>
      <tbody>
        {% for consulta in objects %}
        <tr>
          <td style="text-align: center;">{{ consulta.fecha_consulta }}</td>
          <td style="text-align: center;">{{ consulta.idpac_id|get_pacient_id }}</td>
          <td style="text-align: center;">{{ consulta.medUltrasonido }}</td>
          <td style="text-align: center;">{{ consulta.motivo_consulta }}</td>
          <td style="text-align: center;">
            <a href="/registros/consulta/{{ consulta }}" class="eye-search">
              <i class="fa-regular fa-eye search"></i>
            </a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" style="text-align: center;">No existen registros.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div id="pagination"></div>
  </div>

  <script>
    var table = document.getElementById("myTable");
var tbody = table.getElementsByTagName("tbody")[0]; // Get the tbody element

var rowsPerPage = 10; // Number of rows to display per page
var currentPage = 1; // Current page number

// Calculate the total number of pages
var totalPages = Math.ceil(table.rows.length / rowsPerPage);

// Function to display the rows for the current page
function displayRows() {
  var start = (currentPage - 1) * rowsPerPage;
  var end = start + rowsPerPage;

  // Hide all rows in the tbody
  for (var i = 0; i < tbody.rows.length; i++) {
    tbody.rows[i].style.display = "none";
  }

  // Show the rows for the current page
  for (var j = start; j < end; j++) {
    if (tbody.rows[j]) {
      tbody.rows[j].style.display = "";
    }
  }
}

// Function to generate the pagination links
function generatePaginationLinks() {
  var pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  // Create previous page link
  var prevLink = document.createElement("a");
  prevLink.href = "#";
  prevLink.textContent = "Anterior";
  prevLink.addEventListener("click", function (event) {
    event.preventDefault();
    if (currentPage > 1) {
      currentPage--;
      displayRows();
    }
  });
  pagination.appendChild(prevLink);

  // Create page number links
  for (var page = 1; page <= totalPages; page++) {
    var pageLink = document.createElement("a");
    pageLink.href = "#";
    pageLink.textContent = page;
    pageLink.addEventListener("click", function (event) {
      event.preventDefault();
      currentPage = parseInt(event.target.textContent);
      displayRows();
    });
    pagination.appendChild(pageLink);
  }

  // Create next page link
  var nextLink = document.createElement("a");
  nextLink.href = "#";
  nextLink.textContent = "Siguiente";
  nextLink.addEventListener("click", function (event) {
    event.preventDefault();
    if (currentPage < totalPages) {
      currentPage++;
      displayRows();
    }
  });
  pagination.appendChild(nextLink);
}

// Display the initial rows and generate pagination links
displayRows();
generatePaginationLinks();

    
  </script>

{% endblock %}
